# Secrets **exercises**

In this Demo:

You will create the sample Secret Imperatively.
Then you will inject this Secret inside Pod as Environment Variables and Files inside the volume.


NOTE: 

a. To successfully finish this exercise, It is important to go through Secret Concept and Demo videos in this series.
b. You can refer to Kuberenetes Docs for help when needed.

TASK-1: Create Secret with below configuration using "kubectl create secret..." command:

- Secret Name: cred-secret
- username: admin
- password: pa$$1254

```bash
kubectl create secret generic cred-secret --from-literal username=admin --from-literal passowrd=pa$$1254
secret/cred-secret created
```

TASK-2: Displaying Secret:

a. Display Secret

```bash
kubectl get secrets

kubectl get secrets cred-secret
```

b. Display complete details of Secret

```bash
kubectl describe secrets cred-secret 
Name:         cred-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
passowrd:  11 bytes
username:  5 bytes

```

b. Display Secret and print that in YAML format

```yaml
kubectl get secrets cred-secret -o yaml
apiVersion: v1
data:
  passowrd: cGExNjI2MjEyNTQ=
  username: YWRtaW4=
kind: Secret
metadata:
  creationTimestamp: "2025-08-19T09:18:41Z"
  name: cred-secret
  namespace: default
  resourceVersion: "170207"
  uid: ba6b1316-329a-48cd-9978-df2ca3924c29
type: Opaque
```

TASK-3: Injecting Secret into Pod as Environment Variables:

a. Create a Pod with two environment variables. These two env variables consists values of username and password from above "cred-secret" Secret object.

```bash
kubectl run pod-nginx-secret --image nginx --dry-run=client -o yaml > pod-nginx-secret.yaml
```
Edit:

```bash
nano pod-nginx-secret.yaml
```

```yaml
# pod-nginx-secret.yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: pod-nginx-secret
  name: pod-nginx-secret
spec:
  containers:
  - image: nginx
    name: pod-nginx-secret
    env:
    - name: USERNAME
      valueFrom:
        secretKeyRef:
          name: cred-secret
          key: username
    - name: PASSWORD
      valueFrom:
        secretKeyRef:
          name: cred-secret
          key: password
  restartPolicy: Never
  ```

b. Display the Pod.

```bash
kubectl get pods pod-nginx-secret 
NAME               READY   STATUS    RESTARTS   AGE
pod-nginx-secret   1/1     Running   0          8m32s

```

c. Ensure above Pod is successfully configured with two environment variables. You can confirm that by running "exec" command with "env" option on that Pod.

```bash
kubectl exec pod-nginx-secret  -- env
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=pod-nginx-secret
NGINX_VERSION=1.29.1
NJS_VERSION=0.9.1
NJS_RELEASE=1~bookworm
PKG_RELEASE=1~bookworm
DYNPKG_RELEASE=1~bookworm
PASSWORD=pa162621254
USERNAME=admin
KUBERNETES_PORT=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_PROTO=tcp
KUBERNETES_PORT_443_TCP_PORT=443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
KUBERNETES_SERVICE_HOST=10.96.0.1
KUBERNETES_SERVICE_PORT=443
KUBERNETES_SERVICE_PORT_HTTPS=443
HOME=/root
```

```bash
kubectl exec secret-env-pod -- printenv USERNAME
kubectl exec secret-env-pod -- printenv PASSWORD
```



TASK-4: Injecting "Secrets" into Pod As "Files" inside the Volume:

a. Create a Pod with "cred-secret" Secret mounted inside the Volumes. The username and password from above "cred-secret" Secret object shall be created as files inside the mount-path.

Create Pod with imperative form

```bash
kubectl run secret-vol-pod --image nginx --restart Never --dry-run=client -o yaml > secret-vol-pod.yaml
```

Edit Pod and adapt requirements

```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: secret-vol-pod
  name: secret-vol-pod
spec:
  containers:
  - image: nginx
    name: secret-vol-pod
    volumeMounts:
    - name: secret-vol
      mountPath: /etc/secret-data
      readOnly: true
  volumes:
  - name: secret-vol
    secret:
      secretName: cred-secret
  restartPolicy: Never
  ```

- ðŸ“ Â¿QuÃ© hace este YAML?
Monta el Secret cred-secret como un volumen llamado secret-vol.

Dentro del contenedor, el volumen se monta en /etc/secret-data.

Las claves del Secret (username, password) se convierten en archivos:

/etc/secret-data/username

/etc/secret-data/password


b. Display the Pod.

```bash
kubectl get pod secret-vol-pod 
NAME             READY   STATUS    RESTARTS   AGE
secret-vol-pod   1/1     Running   0          2m48s
```


c. Ensure above Pod is successfully configured with "username" and "password" files and contents of that files shall be "admin" and "pa$$1254" as per the definition of "cred-secret".

```bash
kubectl exec secret-vol-pod -- cat /etc/secret-data/username
kubectl exec secret-vol-pod -- cat /etc/secret-data/password
```

1. Verifica que el Secret tenga las claves correctas
Ejecuta:

```bash
kubectl get secret cred-secret -o yaml
```

AsegÃºrate de que tenga las claves username y password. VerÃ¡s algo como:

```yaml
data:
  username: YWRtaW4=
  password: c3VwZXJzZWNyZXQ=
```

Puedes decodificarlo con:

```bash
echo YWRtaW4= | base64 --decode
```

ðŸ“ 2. Verifica que los archivos estÃ©n montados en el Pod
Ejecuta:

```bash
kubectl exec secret-vol-pod -- ls /etc/secret-data
```

3. Verifica que el contenedor estÃ© corriendo
AsegÃºrate de que el Pod estÃ© en estado Running:

```bash
kubectl get pod secret-vol-pod
```

Si estÃ¡ en CrashLoopBackOff o Error, revisa los logs:

```bash
kubectl logs secret-vol-pod
```

ðŸ›  4. Verifica el volumeMount en el YAML
AsegÃºrate de que el mountPath en el contenedor coincida con el que estÃ¡s usando en el comando:

```yaml
volumeMounts:
- name: secret-vol
  mountPath: /etc/secret-data
```

5. Prueba con un shell dentro del contenedor
En lugar de usar cat, entra al contenedor:

```bash
kubectl exec -it secret-vol-pod -- /bin/sh

ls -laF /etc/secret-data
total 0
drwxrwxrwt. 3 root root 120 Aug 19 10:39 ./
drwxr-xr-x. 1 root root  42 Aug 19 10:39 ../
drwxr-xr-x. 2 root root  80 Aug 19 10:39 ..2025_08_19_10_39_44.407286610/
lrwxrwxrwx. 1 root root  31 Aug 19 10:39 ..data -> ..2025_08_19_10_39_44.407286610/
lrwxrwxrwx. 1 root root  15 Aug 19 10:39 password -> ..data/password
lrwxrwxrwx. 1 root root  15 Aug 19 10:39 username -> ..data/username

cat /etc/secret-data/username
admin
```

TASK-5: Delete Pod and Secret: 

a. Delete the Pod created above.

```bash
kubectl delete pod secret-vol-pod

kubectl delete pod pod-nginx-secret
```

b. Delete the "cred-secret" created in above task-1.

```bash
kubectl delete secret cred-secret 
```

c. Ensure Pod and Secret is deleted successfully

```bash
kubectl get secrets
No resources found in default namespace.
```

